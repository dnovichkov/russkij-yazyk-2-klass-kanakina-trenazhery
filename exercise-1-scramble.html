<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–£—Ä–æ–≤–µ–Ω—å 1 ‚Äî —Å–æ–±—Ä–∞—Ç—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤</title>
<style>
  :root{
    --bg:#f3f4f4; --card:#fff; --accent:#0f62fe; --muted:#6b7280;
    --wrong:#ff4d4f;
  }
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);margin:0;color:#0b1220}
  header{padding:18px;text-align:center;background:white;box-shadow:0 1px 0 rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:space-between;gap:12px}
  header h1{margin:0;font-size:1.05rem}
  header .home{margin-left:auto;text-decoration:none;background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px}
  main{max-width:920px;margin:18px auto;padding:16px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button, .btn{background:var(--accent);color:white;border:none;padding:10px;border-radius:10px;cursor:pointer}
  .btn.alt{background:#6b7280}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.04);margin-bottom:12px}
  .scramble{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
  .tile{min-width:44px;min-height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#f8fafc;border:1px solid #e6eef8;font-size:20px;cursor:pointer;user-select:none}
  .tile.hidden{visibility:hidden}
  .slots{display:flex;gap:6px;flex-wrap:wrap;margin-top:12px}
  .slot{min-width:44px;min-height:44px;border-radius:8px;background:#fff;border:2px dashed #e6eef8;display:flex;align-items:center;justify-content:center;font-size:20px;position:relative}
  .slot.space{background:transparent;border:0;min-width:30px}
  .slot.wrong{box-shadow:0 0 0 3px rgba(255,77,79,0.12); border-color:var(--wrong)}
  .status{margin-top:12px;color:var(--muted)}
  .hint{background:#f9fafb;color:#374151;border-radius:8px;padding:6px}
  .drop-indicator{position:absolute;inset:0;border-radius:8px;pointer-events:none}
  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <h1>–£—Ä–æ–≤–µ–Ω—å 1 ‚Äî —Å–æ–±—Ä–∞—Ç—å —Å–ª–æ–≤–æ –∏–∑ –±—É–∫–≤</h1>
  <div style="display:flex;gap:8px;align-items:center">
    <a class="home" href="index.html">üè† –î–æ–º–æ–π</a>
  </div>
</header>

<main>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
      <div class="controls">
        <button id="playBtn">‚ñ∂ –î–∏–∫—Ç–æ–≤–∫–∞</button>
        <button id="replayBtn" class="btn alt">‚ü≥ –ü–æ–≤—Ç–æ—Ä</button>
        <button id="hintBtn" class="btn alt">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞)</button>
        <button id="shuffleBtn" class="btn alt">üîÄ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
      </div>
      <div>
        <button id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button id="nextBtn" class="btn alt">–°–ª–µ–¥—É—é—â–µ–µ</button>
      </div>
    </div>

    <div style="margin-top:12px" class="status">
      <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> <span id="progress">0 / 0</span>
    </div>

    <div style="margin-top:16px">
      <div class="card">
        <div><strong>–ë—É–∫–≤—ã:</strong></div>
        <div id="bank" class="scramble" aria-live="polite"></div>
        <div style="margin-top:8px"><small class="hint">–ö–ª–∏–∫ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±—É–∫–≤—É –≤ –Ω—É–∂–Ω—É—é —è—á–µ–π–∫—É. –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –±—É–∫–≤—É ‚Äî –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —è—á–µ–π–∫–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ—ë –æ–±—Ä–∞—Ç–Ω–æ.</small></div>
      </div>

      <div class="card">
        <div><strong>–°–æ–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ:</strong></div>
        <div id="slots" class="slots" aria-live="polite"></div>
      </div>

      <div id="feedback" style="margin-top:8px;font-weight:600;"></div>
    </div>
  </div>

  <div class="card">
    <h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h3>
    <ol>
      <li>–°–ª–æ–≤–æ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.</li>
      <li>–î–æ–±–∞–≤–ª—è–π—Ç–µ –±—É–∫–≤—ã –∫–ª–∏–∫–æ–º –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º –≤ –Ω—É–∂–Ω—ã–µ —è—á–µ–π–∫–∏.</li>
      <li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±—É–∫–≤—ã –±—É–¥—É—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.</li>
      <li>–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–æ–≤—É.</li>
    </ol>
  </div>
</main>

<script>
/* ============================
   –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤
   ============================ */
const WORDS = [
"–∞–ª—Ñ–∞–≤–∏—Ç","–∞–ø—Ä–µ–ª—å","–±–µ—Ä—ë–∑–∞","–±—ã—Å—Ç—Ä–æ","–≤–¥—Ä—É–≥","–≤–µ—Å–µ–ª–æ","–≤–µ—Ç–µ—Ä","–≤–æ—Ä–æ–±–µ–π","–≤–æ—Ä–æ–Ω–∞",
"–≥–æ—Ä–æ–¥","–¥–µ–≤–æ—á–∫–∞","–¥–µ–∂—É—Ä–Ω—ã–π","–¥–µ–∫–∞–±—Ä—å","–¥–µ—Ä–µ–≤–Ω—è","–¥–æ—Ä–æ–≥–∞","–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è",
"–∑–∞–≤–æ–¥","–∑–∞—è—Ü","–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ","–∑–µ–º–ª—è–Ω–∏–∫–∞","–∏–∑–≤–∏–Ω–∏—Ç–µ","–∏–Ω–µ–π","–∫–∞–ø—É—Å—Ç–∞","–∫–∞—Ä–∞–Ω–¥–∞—à",
"–∫–∞—Ä—Ç–∏–Ω–∞","–∫–ª–∞—Å—Å","–∫–æ–Ω—å–∫–∏","–∫–æ—Ä–æ–≤–∞","–ª–æ–ø–∞—Ç–∞","–ª—è–≥—É—à–∫–∞","–º–∞–≥–∞–∑–∏–Ω","–º–∞–ª–∏–Ω–∞","–º–∞—à–∏–Ω–∞",
"–º–µ–±–µ–ª—å","–º–µ–¥–≤–µ–¥—å","–º–µ—Å—è—Ü","–º–µ—Ç–µ–ª—å","–º–µ—Ç—Ä–æ","–º–æ–ª–æ–∫–æ","–º–æ–ª–æ—Ç–æ–∫","–º–æ—Ä–∫–æ–≤—å","–º–æ—Ä–æ–∑","–º–æ—Å–∫–≤–∞",
"–Ω–∞—Ä–æ–¥","–Ω–æ—è–±—Ä—å","–æ–±–µ–¥","–æ–±–µ–∑—å—è–Ω–∞","–æ–±–ª–∞–∫–æ","–æ–¥–µ–∂–¥–∞","–æ–∫—Ç—è–±—Ä—å","–æ—Å–∏–Ω–∞","–æ—Ç–µ—Ü",
"–ø–∞–ª—å—Ç–æ","–ø–µ–Ω–∞–ª","–ø–µ—Ç—É—Ö","–ø–ª–∞—Ç—å–µ","–ø–æ—Å—É–¥–∞","–ø—Ä–æ—â–∞–π","—Ä–∞–±–æ—Ç–∞","—Ä–∞–±–æ—á–∏–π","—Ä–µ–±—è—Ç–∞","—Ä–∏—Å—É–Ω–æ–∫",
"—Ä–æ–¥–∏–Ω–∞","—Ä–æ—Å—Å–∏—è","—Ä—É—Å—Å–∫–∏–π","—Å–∞–ø–æ–≥–∏","—Å–∞—Ö–∞—Ä","—Å–µ–Ω—Ç—è–±—Ä—å","—Å–∫–æ—Ä–æ","—Å–Ω–µ–≥–∏—Ä—å","—Å–æ–±–∞–∫–∞","—Å–æ—Ä–æ–∫–∞",
"—Å–ø–∞—Å–∏–±–æ","—Å—Ç–∞–∫–∞–Ω","—Å—É–±–±–æ—Ç–∞","—Ç–∞—Ä–µ–ª–∫–∞","—Ç–µ—Ç—Ä–∞–¥—å","—Ç–æ–≤–∞—Ä–∏—â","—Ç–æ–ø–æ—Ä","—É–ª–∏—Ü–∞","—É—Ä–æ–∂–∞–π",
"—É—á–µ–Ω–∏–∫","—É—á–µ–Ω–∏—Ü–∞","—É—á–∏—Ç–µ–ª—å","—É—á–∏—Ç–µ–ª—å–Ω–∏—Ü–∞","—Ñ–∞–º–∏–ª–∏—è","—Ñ–µ–≤—Ä–∞–ª—å","—Ö–æ—Ä–æ—à–æ","—â–∞–≤–µ–ª—å",
"—è–±–ª–æ–∫–æ","—è–±–ª–æ–Ω—è","—è–≥–æ–¥–∞","—è–∑—ã–∫","—è–Ω–≤–∞—Ä—å"
];

/* ============================
   –°–æ—Å—Ç–æ—è–Ω–∏–µ
   ============================ */
let pool = [];
let idx = 0;
let current = "";
let slotsState = [];
const progressEl = document.getElementById('progress');
const bankEl = document.getElementById('bank');
const slotsEl = document.getElementById('slots');
const feedback = document.getElementById('feedback');

/* ============================
   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
   ============================ */
function initPool() {
  pool = [...WORDS];
  pool.sort(()=>Math.random()-0.5);
  idx = 0;
  updateProgress();
}
function updateProgress(){ progressEl.textContent = `${idx} / ${pool.length}` }

/* ============================
   TTS: –Ω–∞–¥—ë–∂–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤
   ============================ */
let voices = [];
function loadVoices(){ voices = speechSynthesis.getVoices() || []; }
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function waitVoices(timeout = 1000) {
  return new Promise(resolve => {
    loadVoices();
    if ((speechSynthesis.getVoices() || []).some(v => v.lang && v.lang.toLowerCase().startsWith('ru'))) {
      resolve(true);
      return;
    }
    // –ø—Ä–æ–±—É–µ–º –∂–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ voiceschanged / –∫—Ä–∞—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
    let waited = 0;
    const step = 150;
    const iv = setInterval(()=>{
      loadVoices();
      waited += step;
      if ((speechSynthesis.getVoices() || []).some(v => v.lang && v.lang.toLowerCase().startsWith('ru')) || waited >= timeout) {
        clearInterval(iv);
        resolve(true);
      }
    }, step);
  });
}

function chooseRussianVoice(){
  const vs = speechSynthesis.getVoices() || [];
  let v = vs.find(x => x.lang && x.lang.toLowerCase().startsWith('ru'));
  if (!v) v = vs.find(x => /russian/i.test(x.name));
  return v || null;
}

function speakText(text, rate=0.95){
  if (!('speechSynthesis' in window)) return;
  const utter = new SpeechSynthesisUtterance(text);
  const v = chooseRussianVoice();
  if (v) utter.voice = v;
  utter.rate = rate;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

/* ============================
   –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ª–æ–≤–∞ –∏ —Ä–µ–Ω–¥–µ—Ä
   ============================ */
function prepareWord(w) {
  current = w;
  const letters = Array.from(w);
  const tiles = letters.filter(ch => ch !== ' ');
  const timestamp = Date.now();
  const tilesWithId = tiles.map((ch,i)=> ({ch, id:`tile-${i}-${timestamp}-${Math.floor(Math.random()*10000)}`} ));
  for (let i = tilesWithId.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [tilesWithId[i], tilesWithId[j]] = [tilesWithId[j], tilesWithId[i]];
  }
  renderBank(tilesWithId);
  renderSlots(letters);
  feedback.textContent = '';
  // –∂–¥–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞ (–¥–æ 1—Å) –∏ –∑–∞—Ç–µ–º –ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Å–ª–æ–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  waitVoices(1000).then(()=> {
    // –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —É—Å–ø–µ–ª —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å TTS –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö
    setTimeout(()=> speakText(current, 0.95), 150);
  });
}

function renderBank(tiles) {
  bankEl.innerHTML = '';
  tiles.forEach(tile => {
    const btn = document.createElement('div');
    btn.className = 'tile';
    btn.textContent = tile.ch;
    btn.dataset.letter = tile.ch;
    btn.dataset.id = tile.id;
    btn.draggable = true;
    btn.addEventListener('click', onBankClick);
    btn.addEventListener('dragstart', onTileDragStart);
    bankEl.appendChild(btn);
  });
}

function renderSlots(letters){
  slotsState = letters.map(ch => (ch===' ' ? {ch:' ', tileId:null} : {ch:'', tileId:null}));
  slotsEl.innerHTML = '';
  letters.forEach((ch,i) => {
    const s = document.createElement('div');
    s.className = 'slot' + (ch===' ' ? ' space' : '');
    s.dataset.pos = i;
    s.dataset.accepts = ch===' ' ? 'no' : 'yes';
    s.addEventListener('click', onSlotClick);
    s.addEventListener('dragover', onSlotDragOver);
    s.addEventListener('drop', onSlotDrop);
    s.addEventListener('dragenter', onSlotDragEnter);
    s.addEventListener('dragleave', onSlotDragLeave);
    s.setAttribute('aria-label', ch===' ' ? '–ø—Ä–æ–±–µ–ª' : `—Å–ª–æ—Ç ${i+1}`);
    const content = document.createElement('div');
    content.className = 'slot-content';
    content.style.pointerEvents = 'none';
    content.textContent = ch===' ' ? ' ' : '';
    s.appendChild(content);
    slotsEl.appendChild(s);
  });
  updateSlotsUI();
}

/* ============================
   –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –∫–ª–∏–∫ –∏ drag&drop
   ============================ */
function onBankClick(e){
  const tileEl = e.currentTarget;
  const tileId = tileEl.dataset.id;
  const letter = tileEl.dataset.letter;
  const pos = slotsState.findIndex(v => v.ch === '');
  if (pos === -1) return;
  placeTileToSlot(tileId, letter, pos);
}

function onTileDragStart(e){
  const tileEl = e.currentTarget;
  e.dataTransfer.setData('text/plain', JSON.stringify({
    from: 'bank',
    id: tileEl.dataset.id,
    letter: tileEl.dataset.letter
  }));
  if (e.dataTransfer.setDragImage) {
    const crt = tileEl.cloneNode(true);
    crt.style.position='absolute'; crt.style.top='-1000px'; crt.style.left='-1000px';
    document.body.appendChild(crt);
    e.dataTransfer.setDragImage(crt, 20, 20);
    setTimeout(()=> document.body.removeChild(crt), 0);
  }
}

function onSlotDragStart(e){
  const slot = e.currentTarget;
  const pos = Number(slot.dataset.pos);
  const info = slotsState[pos];
  if (!info || !info.tileId) { e.preventDefault(); return; }
  e.dataTransfer.setData('text/plain', JSON.stringify({
    from: 'slot',
    id: info.tileId,
    letter: info.ch,
    pos
  }));
}

function onSlotDragOver(e){ e.preventDefault(); }
function onSlotDragEnter(e){ e.currentTarget.classList.add('dragover'); }
function onSlotDragLeave(e){ e.currentTarget.classList.remove('dragover'); }

function onSlotDrop(e){
  e.preventDefault();
  e.currentTarget.classList.remove('dragover');
  const payload = JSON.parse(e.dataTransfer.getData('text/plain'));
  const pos = Number(e.currentTarget.dataset.pos);
  if (e.currentTarget.dataset.accepts === 'no') return;
  if (payload.from === 'bank'){
    if (slotsState[pos].tileId){
      showTileById(slotsState[pos].tileId);
    }
    placeTileToSlot(payload.id, payload.letter, pos);
  } else if (payload.from === 'slot'){
    const fromPos = payload.pos;
    if (fromPos === pos) return;
    const targetTile = slotsState[pos];
    const fromTile = slotsState[fromPos];
    slotsState[pos] = { ch: fromTile.ch, tileId: fromTile.tileId };
    slotsState[fromPos] = { ch: targetTile.ch || '', tileId: targetTile.tileId || null };
    updateSlotsUI();
  }
}

function placeTileToSlot(tileId, letter, pos){
  const tileEl = findTileElById(tileId);
  if (!tileEl) return;
  tileEl.classList.add('hidden');
  if (slotsState[pos].tileId){
    showTileById(slotsState[pos].tileId);
  }
  slotsState[pos] = { ch: letter, tileId };
  const slotEl = slotsEl.querySelector(`.slot[data-pos="${pos}"]`);
  if (slotEl && !slotEl.draggable){
    slotEl.draggable = true;
    slotEl.addEventListener('dragstart', onSlotDragStart);
  }
  updateSlotsUI();
}

function findTileElById(id){
  return Array.from(bankEl.children).find(c => c.dataset.id === id);
}

function showTileById(id){
  const t = findTileElById(id);
  if (t) t.classList.remove('hidden');
}

function onSlotClick(e){
  const pos = Number(e.currentTarget.dataset.pos);
  if (!slotsState[pos] || !slotsState[pos].tileId) return;
  const tileId = slotsState[pos].tileId;
  showTileById(tileId);
  slotsState[pos] = { ch:'', tileId:null };
  updateSlotsUI();
}

function updateSlotsUI(){
  Array.from(slotsEl.children).forEach((el, i) => {
    const st = slotsState[i];
    const content = el.querySelector('.slot-content');
    if (!content) return;
    content.textContent = st.ch === ' ' ? ' ' : (st.ch || '');
    el.classList.remove('wrong');
  });
}

/* ============================
   –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   ============================ */
function getAssembled(){
  return slotsState.map(s => s.ch === ' ' ? ' ' : (s.ch || '')).join('');
}

function checkAnswer(){
  const assembled = getAssembled();
  const target = current;
  if (assembled.toLowerCase() === target.toLowerCase()){
    feedback.style.color = 'green';
    feedback.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ';
    idx++;
    saveProgress();
    setTimeout(()=> {
      nextWord();
    }, 600);
  } else {
    feedback.style.color = 'crimson';
    feedback.textContent = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–¥—Å–≤–µ—á—É –æ—à–∏–±–æ—á–Ω—ã–µ –±—É–∫–≤—ã.';
    highlightWrongSlots(assembled, target);
  }
}

function highlightWrongSlots(assembled, target){
  const assembledArr = Array.from(assembled);
  const targetArr = Array.from(target);
  const maxLen = Math.max(assembledArr.length, targetArr.length);
  for (let i=0;i<maxLen;i++){
    const a = assembledArr[i] || '';
    const t = targetArr[i] || '';
    const slotEl = slotsEl.querySelector(`.slot[data-pos="${i}"]`);
    if (!slotEl) continue;
    if (t === ' ') continue;
    if (!a || a.toLowerCase() !== t.toLowerCase()){
      slotEl.classList.add('wrong');
    } else {
      slotEl.classList.remove('wrong');
    }
  }
}

/* ============================
   –ü–æ–¥—Å–∫–∞–∑–∫–∞
   ============================ */
function revealFirst(){
  const letters = Array.from(current);
  const firstLetter = letters.find(ch => ch !== ' ');
  if (!firstLetter) return;
  const pos = slotsState.findIndex(v => v.ch === '');
  if (pos === -1) return;
  const tileEl = Array.from(bankEl.children).find(t => t.dataset.letter === firstLetter && !t.classList.contains('hidden'));
  if (!tileEl) return;
  placeTileToSlot(tileEl.dataset.id, firstLetter, pos);
}

/* ============================
   localStorage
   ============================ */
function saveProgress(){
  localStorage.setItem('russian_scramble_progress', JSON.stringify({pool, idx}));
}
function loadProgress(){
  const raw = localStorage.getItem('russian_scramble_progress');
  if (!raw) return false;
  try {
    const obj = JSON.parse(raw);
    if (obj && Array.isArray(obj.pool) && typeof obj.idx === 'number'){
      pool = obj.pool;
      idx = obj.idx;
      return true;
    }
  }catch(e){}
  return false;
}

/* ============================
   –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ª–æ–≤–∞–º
   ============================ */
function pickNext(){
  if (!pool || pool.length === 0) initPool();
  if (idx >= pool.length){
    alert('–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞! –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ.');
    initPool();
  }
  const w = pool[idx];
  prepareWord(w);
  updateProgress();
}

document.getElementById('playBtn').addEventListener('click', ()=> speakText(current));
document.getElementById('replayBtn').addEventListener('click', ()=> speakText(current));
document.getElementById('hintBtn').addEventListener('click', revealFirst);
document.getElementById('shuffleBtn').addEventListener('click', ()=> {
  const tiles = Array.from(bankEl.children).map(t => ({id:t.dataset.id, ch:t.dataset.letter}));
  tiles.sort(()=>Math.random()-0.5);
  renderBank(tiles);
});
document.getElementById('checkBtn').addEventListener('click', checkAnswer);
document.getElementById('nextBtn').addEventListener('click', ()=> { idx++; pickNext(); });

/* drag->bank (–≤–æ–∑–≤—Ä–∞—Ç) */
bankEl.addEventListener('dragover', e => e.preventDefault());
bankEl.addEventListener('drop', e => {
  e.preventDefault();
  try {
    const payload = JSON.parse(e.dataTransfer.getData('text/plain'));
    if (payload.from === 'slot'){
      showTileById(payload.id);
      const pos = payload.pos;
      if (typeof pos === 'number') {
        slotsState[pos] = { ch:'', tileId:null };
        updateSlotsUI();
      }
    }
  } catch(err){}
});

/* ============================
   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   ============================ */
if (!loadProgress()) initPool();
pickNext();
updateProgress();
</script>
</body>
</html>
